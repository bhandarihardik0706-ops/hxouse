<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>HXOUSE Coffee Co. | Aniga Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,400..900&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --bg-primary-light: #FFFFFF; --bg-secondary-light: #F3F4F6; --text-primary-light: #111827; --text-secondary-light: #6B7280; --border-light: #E5E7EB; --brand-primary-light: #111827;
            --bg-primary-dark: #111111; --bg-secondary-dark: #1F2023; --text-primary-dark: #F9FAFB; --text-secondary-dark: #9CA3AF; --border-dark: #374151; --brand-primary-dark: #FFFFFF;
            --bg-primary-matcha: #F0FFF4; --bg-secondary-matcha: #DCF2E3; --text-primary-matcha: #2F4858; --text-secondary-matcha: #5C7A89; --border-matcha: #B8D8C0; --brand-primary-matcha: #3A8154;
            --app-height: 100vh;
        }
        [data-theme="light"] { --bg-primary: var(--bg-primary-light); --bg-secondary: var(--bg-secondary-light); --text-primary: var(--text-primary-light); --text-secondary: var(--text-secondary-light); --border-color: var(--border-light); --brand-primary: var(--brand-primary-light); }
        [data-theme="dark"] { --bg-primary: var(--bg-primary-dark); --bg-secondary: var(--bg-secondary-dark); --text-primary: var(--text-primary-dark); --text-secondary: var(--text-secondary-dark); --border-color: var(--border-dark); --brand-primary: var(--brand-primary-dark); }
        [data-theme="matcha"] { --bg-primary: var(--bg-primary-matcha); --bg-secondary: var(--bg-secondary-matcha); --text-primary: var(--text-primary-matcha); --text-secondary: var(--text-secondary-matcha); --border-color: var(--border-matcha); --brand-primary: var(--brand-primary-matcha); }

        html, body { height: 100%; overflow: hidden; margin: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: #000000; color: var(--text-primary); -webkit-tap-highlight-color: transparent; transition: background-color 0.5s ease; }
        .app-container { background-color: var(--bg-primary); transition: background-color 0.5s ease; height: var(--app-height); }
        .text-primary { color: var(--text-primary); } .text-secondary { color: var(--text-secondary); }
        .bg-primary { background-color: var(--bg-primary); } .bg-secondary { background-color: var(--bg-secondary); }
        .border-custom { border-color: var(--border-color); } .brand-text { color: var(--brand-primary); }
        .brand-bg { background-color: var(--brand-primary); color: var(--bg-primary); }

        .fade-in { animation: fadeIn 0.5s ease-in-out; } @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-overlay { animation: fadeIn 0.3s ease; }
        .modal-content { animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); max-height: 85vh; overflow-y: auto; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .accordion-content { transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out; overflow: hidden; max-height: 0; opacity: 0; }
        .accordion-content.open { opacity: 1; }

        .instagram-card { background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
        .classy-x { font-family: 'Playfair Display', serif; font-style: italic; font-weight: 600; font-size: 1.5em; vertical-align: -0.2em; }
        
        .quantity-control { display: flex; align-items: center; justify-content: space-between; background-color: var(--brand-primary); color: var(--bg-primary); border-radius: 9999px; font-weight: 600; overflow: hidden; width: 100px; height: 40px; }
        .add-to-cart-btn { width: 40px; height: 40px; border-radius: 50%; background-color: var(--bg-primary); color: var(--brand-primary); border: 2px solid var(--border-color); display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; }
        
        .combo-card { background: linear-gradient(135deg, rgba(58, 129, 84, 0.1) 0%, rgba(58, 129, 84, 0.05) 100%); border: 2px dashed var(--brand-primary); }
        .glow-tag { background-color: var(--brand-primary); color: white; animation: pulseGlow 2s infinite; }
        @keyframes pulseGlow { 0% { opacity: 0.8; } 50% { opacity: 1; box-shadow: 0 0 15px var(--brand-primary); } 100% { opacity: 0.8; } }

        #loyalty-slider { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; background: var(--bg-secondary); border-radius: 4px; outline: none; }
        #loyalty-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 22px; height: 22px; background: var(--brand-primary); border-radius: 50%; cursor: pointer; border: 2px solid var(--bg-primary); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        
        #art-canvas { background: #c4a484; touch-action: none; cursor: crosshair; }

        /* Aniga Special Styles */
        .aniga-float { animation: anigaPulse 3s infinite ease-in-out; }
        @keyframes anigaPulse { 0%, 100% { transform: scale(1); filter: drop-shadow(0 0 5px var(--brand-primary)); } 50% { transform: scale(1.05); filter: drop-shadow(0 0 20px var(--brand-primary)); } }
        .chat-bubble-user { border-radius: 20px 20px 4px 20px; }
        .chat-bubble-aniga { border-radius: 20px 20px 20px 4px; border: 1px solid var(--brand-primary); }
        .listening-ring { position: absolute; border: 2px solid var(--brand-primary); border-radius: 50%; animation: ringExpand 1.5s infinite; opacity: 0; }
        @keyframes ringExpand { 0% { transform: scale(0.5); opacity: 1; } 100% { transform: scale(2); opacity: 0; } }

        /* Countdown Style */
        .countdown-timer { font-variant-numeric: tabular-nums; letter-spacing: 1px; }
    </style>
</head>
<body data-theme="matcha">

    <!-- Splash Loader -->
    <div id="splash-screen" class="fixed inset-0 bg-primary flex flex-col items-center justify-center z-[100]">
        <div class="relative">
            <img src="https://qaytrfhpqsajgfqedxak.supabase.co/storage/v1/object/public/assets/WhatsApp%20Image%202025-10-08%20at%2009.25.36_1c1533ac.jpg" 
                 alt="HXOUSE Logo" class="w-48 h-48 object-contain rounded-full shadow-2xl">
            <div class="listening-ring"></div>
        </div>
        <div id="splash-status" class="mt-12 flex flex-col items-center text-center">
            <div class="w-10 h-10 border-4 border-t-brand border-secondary rounded-full animate-spin mb-6"></div>
            <p class="text-secondary text-xs font-bold tracking-[0.4em] animate-pulse uppercase">Aniga Engine Initializing</p>
        </div>
    </div>

    <!-- Main Container -->
    <div id="app" class="app-container max-w-lg mx-auto shadow-2xl flex flex-col hidden">
        <main class="flex-grow overflow-y-auto relative">
            <div id="main-interface" class="hidden">
                <header id="page-header" class="sticky top-0 bg-primary z-20 h-20 px-6 flex justify-between items-center border-b border-custom"></header>
                <div id="page-content"></div>
            </div>
            <div class="h-24 flex-shrink-0"></div>
        </main>
        
        <!-- Navbar -->
        <nav id="bottom-nav" class="fixed bottom-0 left-1/2 -translate-x-1/2 max-w-lg w-full bg-primary border-t border-custom flex justify-around items-center h-20 z-30 hidden pb-4 shadow-2xl"></nav>
    </div>

    <div id="modal-container"></div>
    <div id="toast" class="hidden fixed bottom-28 left-1/2 -translate-x-1/2 brand-bg py-3 px-8 rounded-full shadow-2xl z-[70] whitespace-nowrap text-white font-black text-xs uppercase tracking-widest">
        <p id="toast-message"></p>
    </div>

<script>
/**
 * HXOUSE COFFEE CO.
 * ANIGA AI ENGINE v3.1 (Countdown & Preview Edition)
 */

const $ = (s) => document.querySelector(s);
const $$ = (s) => document.querySelectorAll(s);

const SUPABASE_URL = 'https://ttdnlatylcqrevzlyrru.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR0ZG5sYXR5bGNxcmV2emx5cnJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxNzAyMDEsImV4cCI6MjA3NTc0NjIwMX0.aiQ1_viA1JrugEyMWxA2e5f2Aqrao9BNgCTb70NWyCc';

const sb = self.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const PAGES = ['home', 'order', 'cart', 'social', 'cowork', 'aniga', 'more'];

const ANIGA_KNOWLEDGE = {
    captions: [
        "Grind now, shine later. ‚òïÔ∏è‚ú®",
        "HXOUSE: Where ideas brew and dreams caffeinate. #HxouseCoffee",
        "Espresso yourself. ‚òïÔ∏èüñ§",
        "Fueled by HXOUSE. Built by Hustle.",
        "A latte focus for the long hustle."
    ],
    suggestions: [
        "Try the Margherita + Peri Peri combo ‚Äì it's the fan favorite today!",
        "Feeling creative? Our Art Studio game is a great way to wait for your order.",
        "If you tag @hxousecoffeeco on IG, you might get a free gift hamper if your order is over ‚Çπ799!"
    ]
};

const CAMPAIGN_COMBOS = [
    { id: 'combo_1', name: 'Margherita + Peri Peri + Drink', price: 159, description: 'Mini Margherita with Peri Peri fries + choice of mocktail/cold frappe', category: 'OFFERS' },
    { id: 'combo_2', name: 'Paneer Tikka + Peri Peri + Drink', price: 179, description: 'Mini Paneer Tikka with Peri Peri fries + choice of mocktail/cold frappe', category: 'OFFERS' },
    { id: 'combo_3a', name: 'Veg Momos + Mocktail', price: 99, description: 'Veg Steam Momos + Mocktail of choice', category: 'OFFERS' },
    { id: 'combo_3b', name: 'Paneer Momos + Mocktail', price: 119, description: 'Paneer Momos + Mocktail of choice', category: 'OFFERS' },
    { id: 'combo_3c', name: 'Cheese Corn Momos + Mocktail', price: 129, description: 'Cheese Corn Momos + Mocktail of choice', category: 'OFFERS' }
];

const app = {
    state: {
        currentPage: 'home',
        cart: [],
        activeOrder: null,
        tableNumber: null,
        user: null,
        customerProfile: null,
        theme: 'matcha',
        menuData: [],
        allMenuItems: [],
        expandedCategory: null,
        searchQuery: '',
        pointsToRedeem: 0,
        realtimeChannel: null,
        isListening: false,
        chatHistory: [{ role: 'aniga', text: "Hey! I'm Aniga. I'm here to guide your HXOUSE experience. Try asking for 'recommendations' or 'Instagram captions'!" }],
        countdownText: "00d 00h 00m 00s",
        countdownInterval: null
    },

    async init() {
        this.setHeight();
        window.addEventListener('resize', () => this.setHeight());
        window.addEventListener('popstate', (e) => this.handleBack(e));

        const initialHash = location.hash.substring(1);
        this.state.currentPage = PAGES.includes(initialHash) ? initialHash : 'home';
        
        this.startCountdown();
        await this.runStartup();
    },

    startCountdown() {
        const target = new Date("March 1, 2026 00:00:00").getTime();
        this.state.countdownInterval = setInterval(() => {
            const now = new Date().getTime();
            const diff = target - now;
            
            if (diff <= 0) {
                this.state.countdownText = "NOW LIVE!";
                clearInterval(this.state.countdownInterval);
            } else {
                const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((diff % (1000 * 60)) / 1000);
                this.state.countdownText = `${String(d).padStart(2, '0')}d ${String(h).padStart(2, '0')}h ${String(m).padStart(2, '0')}m ${String(s).padStart(2, '0')}s`;
            }
            
            const el = $('#home-countdown');
            if (el) el.textContent = this.state.countdownText;
        }, 1000);
    },

    setHeight() { document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`); },

    async runStartup() {
        try {
            const { data: { session } } = await sb.auth.getSession();
            this.state.user = session?.user;
            
            if (!this.state.user) {
                const { data: anon, error: authErr } = await sb.auth.signInAnonymously();
                if (authErr) throw authErr;
                this.state.user = anon.user;
            }

            await Promise.all([this.loadProfile(), this.loadMenu()]);
            this.parseTable();

            $('#splash-screen').style.display = 'none';
            $('#app').classList.remove('hidden');
            $('#app').classList.add('flex');

            if (!this.state.customerProfile || !this.state.customerProfile.name) {
                this.onboard();
            } else if (this.state.tableNumber) {
                this.launch();
            } else {
                this.askTable();
            }
        } catch (e) { console.error("Aniga Error", e); }
    },

    async loadProfile() {
        const { data } = await sb.from('customers').select('*').eq('id', this.state.user.id).maybeSingle();
        this.state.customerProfile = data;
    },

    async loadMenu() {
        const { data, error } = await sb.from('products').select('*').eq('is_available', true).order('id');
        if (error) throw error;
        this.state.allMenuItems = [...(data || []), ...CAMPAIGN_COMBOS];
        const groups = this.state.allMenuItems.reduce((acc, item) => {
            let cat = acc.find(c => c.category === item.category);
            if (!cat) { cat = { category: item.category, items: [] }; acc.push(cat); }
            cat.items.push(item);
            return acc;
        }, []);
        this.state.menuData = groups;
        if (this.state.menuData.length > 0) this.state.expandedCategory = 'OFFERS';
    },

    parseTable() {
        const params = new URLSearchParams(window.location.search);
        const raw = params.get('table');
        if (raw) {
            const map = { "6": 1, "10": 2, "1": 3, "7": 4, "4": 6, "3": 7, "2": 8 };
            this.state.tableNumber = parseInt(map[raw] || raw);
        }
    },

    launch() {
        this.fetchActiveOrder();
        $('#main-interface').classList.remove('hidden');
        $('#bottom-nav').classList.remove('hidden');
        ui.renderNav();
        this.navigateTo(this.state.currentPage, false);
    },

    onboard() {
        ui.showModal('onboard-ui', `
            <div class="text-center">
                <div class="w-24 h-24 brand-bg mx-auto rounded-full flex items-center justify-center text-4xl mb-6 shadow-xl aniga-float">A</div>
                <h2 class="text-4xl font-black mb-2 uppercase tracking-tighter text-primary">HXOUSE ID</h2>
                <p class="text-secondary mb-10 text-sm font-medium">Verify your profile with Aniga.</p>
                <div class="space-y-4">
                    <input type="text" id="ob-name" class="w-full p-5 bg-secondary border border-custom rounded-2xl font-bold uppercase text-center text-primary" placeholder="Full Name">
                    <input type="tel" id="ob-phone" class="w-full p-5 bg-secondary border border-custom rounded-2xl font-bold text-center text-primary" placeholder="WhatsApp Number">
                    ${!this.state.tableNumber ? `<input type="number" id="ob-table" class="w-full p-5 bg-secondary border border-custom rounded-2xl font-bold text-center text-primary" placeholder="Table #">` : ''}
                </div>
                <button onclick="app.submitOnboard()" class="w-full brand-bg mt-12 py-6 rounded-[2rem] font-black text-xl shadow-2xl uppercase">Join HXOUSE</button>
            </div>
        `);
    },

    async submitOnboard() {
        const name = $('#ob-name').value.trim();
        const phone = $('#ob-phone').value.trim();
        const table = this.state.tableNumber || parseInt($('#ob-table')?.value);
        if (!name || phone.length < 10 || isNaN(table)) return ui.showToast("Missing Data");
        try {
            const profile = { id: this.state.user.id, name, whatsapp_number: phone, loyalty_points: 0 };
            await sb.from('customers').upsert(profile);
            this.state.customerProfile = profile;
            this.state.tableNumber = table;
            ui.closeModal('onboard-ui');
            this.launch();
        } catch (e) { ui.showToast("Error joining"); }
    },

    askTable() {
        ui.showModal('table-ui', `
            <h2 class="text-3xl font-black mb-8 uppercase tracking-tighter text-center text-primary">Table Number?</h2>
            <div class="grid grid-cols-5 gap-3 mb-10">
                ${[1,2,3,4,5,6,7,8,9,10].map(n => `<button onclick="$('#manual-table').value=${n}" class="p-5 bg-secondary rounded-2xl font-black border border-custom active:brand-bg text-primary">${n}</button>`).join('')}
            </div>
            <input type="number" id="manual-table" class="w-full p-6 border border-custom rounded-3xl bg-secondary font-black text-center text-4xl text-primary" placeholder="--">
            <button onclick="app.submitTable()" class="w-full brand-bg py-6 rounded-[2rem] font-black text-xl uppercase tracking-widest mt-4">Confirm Spot</button>
        `);
    },

    submitTable() {
        const v = parseInt($('#manual-table').value);
        if (!v) return;
        this.state.tableNumber = v;
        ui.closeModal('table-ui');
        this.launch();
    },

    navigateTo(page, push = true) {
        if (push) location.hash = page;
        this.state.currentPage = page;
        ui.renderHeader();
        ui.renderContent();
        ui.updateNav();
        $('#app main').scrollTo(0, 0);
    },

    handleBack(e) {
        const modal = $('#modal-container').children[0];
        if (modal) { ui.closeModal(modal.id); e.preventDefault(); return; }
        if (this.state.currentPage !== 'home') { this.navigateTo('home'); e.preventDefault(); }
    },

    addCart(id, change) {
        const item = this.state.allMenuItems.find(i => i.id === id);
        let cartItem = this.state.cart.find(i => i.id === id);
        if (!cartItem && change > 0) {
            this.state.cart.push({ ...item, quantity: 1 });
        } else if (cartItem) {
            cartItem.quantity += change;
            if (cartItem.quantity <= 0) this.state.cart = this.state.cart.filter(i => i.id !== id);
        }
        ui.renderContent();
    },

    async fetchActiveOrder() {
        const { data } = await sb.from('orders').select('*, order_items(*, products(*))').eq('customer_id', this.state.user.id).in('status', ['received', 'preparing']).order('created_at', { ascending: false }).limit(1).maybeSingle();
        this.state.activeOrder = data;
        if (data) this.subscribeRealtime(data.id);
        ui.renderContent();
    },

    subscribeRealtime(id) {
        if (this.state.realtimeChannel) sb.removeChannel(this.state.realtimeChannel);
        this.state.realtimeChannel = sb.channel(`order-${id}`).on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'orders', filter: `id=eq.${id}` }, p => {
            this.state.activeOrder = p.new;
            if (['delivered', 'cancelled'].includes(p.new.status)) { this.state.activeOrder = null; ui.showToast(`Order ${p.new.status}`); }
            ui.renderContent();
        }).subscribe();
    },

    startVoice() {
        if (!('webkitSpeechRecognition' in window)) return ui.showToast("Voice not supported");
        const rec = new webkitSpeechRecognition();
        rec.lang = 'en-US';
        rec.onstart = () => { this.state.isListening = true; ui.renderContent(); };
        rec.onend = () => { this.state.isListening = false; ui.renderContent(); };
        rec.onresult = (e) => {
            const transcript = e.results[0][0].transcript.toLowerCase();
            this.handleAnigaInput(transcript);
        };
        rec.start();
    },

    handleAnigaInput(input) {
        this.state.chatHistory.push({ role: 'user', text: input });
        let reply = "I'm not sure about that, but try asking for recommendations!";
        
        if (input.includes('menu') || input.includes('order')) {
            reply = "Redirecting you to our menu!";
            setTimeout(() => this.navigateTo('order'), 1000);
        } else if (input.includes('instagram') || input.includes('social')) {
            reply = "Heading to our socials!";
            setTimeout(() => this.navigateTo('social'), 1000);
        } else if (input.includes('caption')) {
            reply = "Here's a cool caption: " + ANIGA_KNOWLEDGE.captions[Math.floor(Math.random() * ANIGA_KNOWLEDGE.captions.length)];
        } else if (input.includes('suggest') || input.includes('recommend')) {
            reply = ANIGA_KNOWLEDGE.suggestions[Math.floor(Math.random() * ANIGA_KNOWLEDGE.suggestions.length)];
        } else if (input.includes('hi') || input.includes('hello')) {
            reply = "Hi there! I'm Aniga, your talented guide. How can I help you hustle today?";
        }

        setTimeout(() => {
            this.state.chatHistory.push({ role: 'aniga', text: reply });
            ui.renderContent();
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(reply);
                window.speechSynthesis.speak(utterance);
            }
        }, 600);
    },

    async placeOrder(method, btn) {
        btn.disabled = true;
        btn.innerHTML = "SYSTEM PREVIEW";
        ui.showToast("Order System Launching March 1st! (Preview Mode)");
        
        // Mock success for preview
        setTimeout(() => {
            this.state.cart = [];
            ui.closeModal('pay-ui');
            ui.showToast("Order Logged in Preview Mode!");
            this.navigateTo('cart');
        }, 1500);
    }
};

const ui = {
    renderHeader() {
        const h = $('#page-header');
        h.innerHTML = `
            <div onclick="app.navigateTo('home')"><h1 class="text-2xl font-black brand-text tracking-tighter uppercase cursor-pointer">H<span class="classy-x">X</span>OUSE</h1></div>
            <div class="flex items-center space-x-4">
                <div class="text-right">
                    <p class="font-black text-sm tracking-tighter uppercase text-primary">Table #${app.state.tableNumber || '?'}</p>
                    <p class="text-[9px] uppercase opacity-40 font-black tracking-widest text-primary">${app.state.customerProfile?.name || 'Guest'}</p>
                </div>
            </div>`;
    },

    renderContent() {
        const c = $('#page-content');
        const p = app.state.currentPage;
        if (p === 'home') this.home(c);
        else if (p === 'order') this.menu(c);
        else if (p === 'cart') this.cart(c);
        else if (p === 'social') this.social(c);
        else if (p === 'cowork') this.cowork(c);
        else if (p === 'aniga') this.aniga(c);
        else if (p === 'more') this.more(c);
    },

    home(c) {
        c.innerHTML = `
            <div class="space-y-6 fade-in pb-10">
                <!-- Video/Hero Section -->
                <div class="relative h-64 overflow-hidden rounded-b-[3rem] shadow-2xl group">
                    <video src="https://ttdnlatylcqrevzlyrru.supabase.co/storage/v1/object/public/assets/lv_0_20251012011509.mp4" autoplay loop muted playsinline class="absolute top-0 left-0 w-full h-full object-cover opacity-60"></video>
                    <div class="absolute inset-0 bg-black/40 flex flex-col items-center justify-center text-white p-6 transition-all group-hover:bg-black/20">
                        <h1 class="text-4xl font-bold tracking-tighter uppercase leading-none text-center transform group-hover:scale-105 transition">Fuel the <br> Hustle</h1>
                        <p class="text-[10px] font-bold tracking-[0.6em] mt-4 opacity-80 uppercase">AI-Powered Experience</p>
                    </div>
                </div>

                <!-- Limited Offers Countdown -->
                <div class="px-6">
                    <div class="bg-primary border-2 border-custom rounded-3xl p-6 text-center shadow-lg transform scale-[0.98]">
                        <p class="text-[10px] font-black uppercase text-secondary tracking-[0.4em] mb-2">Limited Offers Ending In:</p>
                        <div id="home-countdown" class="text-3xl font-black text-primary tracking-tighter countdown-timer">${app.state.countdownText}</div>
                        <p class="text-[8px] font-black uppercase text-secondary mt-2 opacity-50 tracking-[0.2em]">Full Launch: March 1st, 2026</p>
                    </div>
                </div>

                <!-- Mood Selector -->
                <div class="px-6">
                    <h2 class="font-black text-[10px] uppercase tracking-[0.3em] text-secondary mb-4">Current Vibe</h2>
                    <div class="flex space-x-3 overflow-x-auto no-scrollbar pb-2">
                        ${['‚òïÔ∏è Focused', 'üöÄ Energetic', 'üçµ Calm', 'üé® Creative'].map(m => `
                            <button onclick="ui.showToast('Vibe set: ${m}')" class="flex-shrink-0 px-4 py-2 bg-secondary border border-custom rounded-full text-[10px] font-black uppercase tracking-widest text-primary hover:brand-bg hover:text-white transition-all">${m}</button>
                        `).join('')}
                    </div>
                </div>

                <!-- Flash Combos -->
                <div class="px-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex flex-col">
                            <h2 class="font-black text-xl uppercase tracking-tighter text-primary">Limited Offers</h2>
                            <p class="text-[9px] font-bold text-secondary uppercase tracking-widest">Selected by Aniga</p>
                        </div>
                        <span class="glow-tag text-[9px] px-3 py-1 rounded-full font-black uppercase tracking-widest">FLASH SALE</span>
                    </div>
                    <div class="flex overflow-x-auto space-x-4 pb-4 no-scrollbar">
                        ${CAMPAIGN_COMBOS.map(combo => `
                            <div class="combo-card flex-shrink-0 w-64 p-5 rounded-[2.5rem] shadow-sm relative border border-custom">
                                <h3 class="font-black text-sm uppercase leading-tight text-primary mb-1">${combo.name}</h3>
                                <p class="text-[9px] font-medium text-secondary leading-snug mb-4">${combo.description}</p>
                                <div class="flex justify-between items-center mt-auto">
                                    <span class="font-black text-xl text-primary tracking-tighter">‚Çπ${combo.price}</span>
                                    <button onclick="app.addCart('${combo.id}', 1); ui.showToast('Added to Cart!')" class="brand-bg w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold active:scale-90 transition">+</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- Rewards & Action -->
                <div class="p-6 space-y-6">
                    <div onclick="app.navigateTo('aniga')" class="bg-primary border-4 border-dashed border-custom p-8 rounded-[3rem] text-center shadow-xl cursor-pointer hover:border-brand-primary transition-all">
                        <p class="text-xs font-black text-secondary uppercase tracking-[0.2em] mb-2">Need Guidance?</p>
                        <h2 class="font-black text-2xl text-primary uppercase tracking-tighter">Chat with Aniga</h2>
                    </div>
                    
                    <button onclick="app.navigateTo('order')" class="w-full brand-bg py-7 rounded-[2.5rem] font-black text-2xl shadow-2xl active:scale-95 transition uppercase tracking-tighter">Full Menu</button>
                    
                    <div class="bg-secondary p-8 rounded-[2.5rem] border border-custom shadow-sm flex justify-between items-center">
                        <div class="pr-4">
                            <h3 class="font-black text-lg uppercase tracking-tighter mb-2 text-primary">Rewards</h3>
                            <p class="text-[10px] text-secondary font-bold uppercase tracking-widest">${app.state.customerProfile?.loyalty_points || 0} Points Balance</p>
                        </div>
                        <span class="text-4xl aniga-float">üíé</span>
                    </div>
                </div>
            </div>`;
    },

    menu(c) {
        c.innerHTML = `
            <div class="p-6 fade-in">
                <div class="relative mb-6">
                    <input type="text" placeholder="I want coffee..." class="w-full p-5 bg-secondary border border-custom rounded-2xl font-bold shadow-inner text-primary pl-14" oninput="app.state.searchQuery = this.value; ui.menuList()">
                    <span class="absolute left-5 top-5 opacity-40">üîç</span>
                </div>
                <div id="menu-sections" class="space-y-4"></div>
            </div>`;
        this.menuList();
    },

    menuList() {
        const target = $('#menu-sections');
        if (!target) return;
        const q = app.state.searchQuery.toLowerCase();
        const sortedMenu = [...app.state.menuData].sort((a,b) => a.category === 'OFFERS' ? -1 : 1);

        target.innerHTML = sortedMenu.map(group => {
            const filtered = group.items.filter(i => i.name.toLowerCase().includes(q));
            if (filtered.length === 0 && q) return '';
            const isExp = app.state.expandedCategory === group.category || q;
            return `
                <div class="bg-secondary rounded-[2rem] border border-custom overflow-hidden shadow-sm">
                    <button onclick="app.state.expandedCategory='${group.category}'; ui.menuList()" class="w-full p-6 flex justify-between items-center font-black uppercase text-[10px] tracking-widest text-primary">
                        ${group.category} <span class="text-xl transition-transform ${isExp ? 'rotate-90' : ''}">‚Üí</span>
                    </button>
                    <div class="accordion-content ${isExp ? 'open' : ''}" style="max-height: ${isExp ? '2000px' : '0'}">
                        <div class="p-4 space-y-3">
                            ${filtered.map(i => this.itemCard(i)).join('')}
                        </div>
                    </div>
                </div>`;
        }).join('');
    },

    itemCard(i) {
        const cartItem = app.state.cart.find(ci => ci.id === i.id);
        const isOffer = i.category === 'OFFERS';
        return `
            <div class="${isOffer ? 'combo-card' : 'bg-primary'} p-5 rounded-[1.5rem] shadow-sm flex justify-between items-center border border-custom transition-all active:scale-[0.98]">
                <div class="flex-grow pr-4">
                    <h4 class="font-black text-sm uppercase leading-tight mb-2 tracking-tighter text-primary">${i.name}</h4>
                    <p class="text-secondary font-black text-xs opacity-50 tracking-widest">‚Çπ${i.price}</p>
                </div>
                <div>
                    ${cartItem ? `
                        <div class="quantity-control shadow-sm"><button onclick="app.addCart('${i.id}', -1)" class="px-3">‚àí</button><span class="text-xs">${cartItem.quantity}</span><button onclick="app.addCart('${i.id}', 1)" class="px-3">+</button></div>
                    ` : `<button onclick="app.addCart('${i.id}', 1)" class="add-to-cart-btn brand-bg font-black text-2xl">+</button>`}
                </div>
            </div>`;
    },

    cart(c) {
        if (app.state.activeOrder) return this.track(c);
        if (app.state.cart.length === 0) return c.innerHTML = `<div class="p-20 text-center opacity-30 h-full flex flex-col justify-center"><p class="text-8xl mb-8">üõí</p><p class="font-black tracking-widest uppercase text-xs">Selection Empty</p><button onclick="app.navigateTo('order')" class="mt-8 font-black underline text-primary">GO TO MENU</button></div>`;

        const subtotal = app.state.cart.reduce((t, i) => t + (i.price * i.quantity), 0);
        const maxRedeem = Math.min(Math.floor((app.state.customerProfile?.loyalty_points || 0) * 0.8), Math.floor(subtotal));
        const gst = (subtotal - app.state.pointsToRedeem) * 0.05;
        const total = (subtotal - app.state.pointsToRedeem) + gst;

        c.innerHTML = `
            <div class="p-6 space-y-6 pb-32 fade-in">
                <h2 class="text-4xl font-black tracking-tighter uppercase mb-8 text-primary">Preview Cart</h2>
                <div class="space-y-3">${app.state.cart.map(i => `
                    <div class="flex justify-between items-center p-5 bg-secondary rounded-[1.5rem] border border-custom shadow-sm">
                        <div>
                            <p class="font-black text-sm uppercase text-primary">${i.name}</p>
                            <p class="text-[10px] opacity-40 font-black mt-1 uppercase tracking-widest text-primary">‚Çπ${i.price} x ${i.quantity}</p>
                        </div>
                        <div class="quantity-control shadow-sm">
                            <button onclick="app.addCart('${i.id}', -1)" class="px-3">‚àí</button><span>${i.quantity}</span><button onclick="app.addCart('${i.id}', 1)" class="px-3">+</button>
                        </div>
                    </div>`).join('')}
                </div>
                ${maxRedeem > 0 ? `
                    <div class="p-8 bg-secondary rounded-[2rem] border border-custom shadow-inner text-center">
                        <p class="text-[10px] font-black uppercase mb-6 opacity-40 tracking-[0.2em] text-primary">Redeem Points</p>
                        <input type="range" id="loyalty-slider" min="0" max="${maxRedeem}" value="${app.state.pointsToRedeem}" oninput="app.state.pointsToRedeem = parseInt(this.value); ui.cart($('#page-content'))">
                        <div class="flex justify-between font-black text-[11px] mt-6 uppercase opacity-60 text-primary"><span>‚Çπ${app.state.pointsToRedeem} Off</span><span>Bal: ${app.state.customerProfile.loyalty_points - app.state.pointsToRedeem}</span></div>
                    </div>` : ''}
                <textarea id="special-inst" placeholder="Instructions? Aniga can help if you ask her..." class="w-full p-6 bg-secondary border border-custom rounded-2xl h-28 font-bold text-sm shadow-inner text-primary"></textarea>
                <div class="p-8 bg-secondary rounded-[2.5rem] space-y-3 border border-custom shadow-sm uppercase text-primary">
                    <div class="flex justify-between font-black text-[10px] opacity-40"><span>Subtotal</span><span>‚Çπ${subtotal.toFixed(2)}</span></div>
                    <div class="flex justify-between font-black text-[10px] opacity-40"><span>Tax</span><span>‚Çπ${gst.toFixed(2)}</span></div>
                    <div class="flex justify-between font-black text-2xl pt-4 border-t border-custom tracking-tighter"><span>Total</span><span>‚Çπ${total.toFixed(2)}</span></div>
                </div>
                <button onclick="ui.payModal()" class="w-full brand-bg py-7 rounded-[2.5rem] font-black text-2xl shadow-2xl tracking-tighter uppercase active:scale-95 transition">Preview Checkout</button>
            </div>`;
    },

    track(c) {
        const steps = ['received', 'preparing', 'delivered'];
        const idx = steps.indexOf(app.state.activeOrder?.status || 'received');
        const progress = ((idx + 1) / steps.length) * 100;
        c.innerHTML = `
            <div class="p-10 text-center space-y-16 fade-in h-full flex flex-col justify-center">
                <h2 class="text-5xl font-black tracking-tighter uppercase leading-none text-primary">Live <br> Progress</h2>
                <div class="relative h-6 w-full bg-secondary rounded-full overflow-hidden border border-custom"><div class="absolute h-full brand-bg transition-all duration-1000" style="width: ${progress}%"></div></div>
                <div class="space-y-10 text-left px-4">
                    ${steps.map((s, i) => `<div class="flex items-center space-x-8 ${i <= idx ? '' : 'opacity-10'}"><div class="w-16 h-16 rounded-3xl border-2 border-custom flex items-center justify-center text-3xl bg-secondary">${i === 0 ? 'üìù' : i === 1 ? 'üç≥' : 'üèÅ'}</div><div><p class="font-black text-sm uppercase tracking-widest text-primary">${s}</p><p class="text-[9px] font-bold text-secondary uppercase opacity-60">${i <= idx ? 'Done' : 'Wait'}</p></div></div>`).join('')}
                </div>
                <button onclick="ui.gameModal()" class="bg-secondary px-12 py-5 rounded-full font-black text-xs border border-custom shadow-xl uppercase tracking-widest active:scale-95 transition text-primary">Play Arcade</button>
            </div>`;
    },

    social(c) {
        c.innerHTML = `
            <div class="p-6 space-y-12 fade-in h-full flex flex-col justify-center text-center">
                <h2 class="text-4xl font-black uppercase tracking-tighter leading-none text-primary">Connect @ <br> HXOUSE</h2>
                <div class="bg-secondary p-12 rounded-[3.5rem] border border-custom shadow-2xl">
                    <p class="instagram-card font-black text-3xl mb-10 tracking-tighter cursor-pointer" onclick="window.open('https://instagram.com/hxousecoffeeco', '_blank')">@hxousecoffeeco</p>
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=https://instagram.com/hxousecoffeeco" class="mx-auto rounded-[2.5rem] border-8 border-white p-2 shadow-2xl transition-transform active:rotate-3">
                    <p class="text-[10px] font-black uppercase tracking-[0.6em] mt-12 opacity-40 text-primary">Tap profile to visit</p>
                </div>
                <button onclick="app.navigateTo('aniga')" class="brand-bg py-4 px-10 rounded-full font-black text-[10px] uppercase mx-auto tracking-widest">Ask Aniga for Captions</button>
            </div>`;
    },

    aniga(c) {
        c.innerHTML = `
            <div class="p-6 flex flex-col h-full fade-in">
                <div class="flex-grow overflow-y-auto space-y-4 pr-2 pb-6" id="chat-window">
                    ${app.state.chatHistory.map(chat => `
                        <div class="flex ${chat.role === 'user' ? 'justify-end' : 'justify-start'}">
                            <div class="${chat.role === 'user' ? 'chat-bubble-user brand-bg text-primary' : 'chat-bubble-aniga bg-secondary text-primary'} p-5 max-w-[85%] text-sm font-bold shadow-sm">
                                ${chat.text}
                            </div>
                        </div>
                    `).join('')}
                    ${app.state.isListening ? `
                        <div class="flex justify-start">
                            <div class="chat-bubble-aniga bg-secondary p-5 flex items-center space-x-2">
                                <div class="w-2 h-2 brand-bg rounded-full animate-bounce"></div>
                                <div class="w-2 h-2 brand-bg rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                <div class="w-2 h-2 brand-bg rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
                            </div>
                        </div>
                    ` : ''}
                </div>
                
                <div class="mt-auto space-y-4">
                    <div class="flex space-x-2">
                        <input type="text" id="chat-input" placeholder="Ask Aniga..." class="flex-grow p-6 bg-secondary border border-custom rounded-[2rem] font-bold text-sm text-primary shadow-inner">
                        <button onclick="app.handleAnigaInput($('#chat-input').value); $('#chat-input').value=''" class="brand-bg w-16 h-16 rounded-[2rem] flex items-center justify-center text-xl">‚ûî</button>
                    </div>
                    <button onclick="app.startVoice()" class="w-full flex items-center justify-center space-x-3 py-6 rounded-[2rem] bg-secondary border-2 border-custom font-black uppercase text-xs tracking-widest text-primary active:scale-95 transition">
                        <span class="text-xl">üéôÔ∏è</span>
                        <span>${app.state.isListening ? 'Listening...' : 'Tap for Voice'}</span>
                    </button>
                </div>
            </div>`;
        const win = $('#chat-window');
        win.scrollTop = win.scrollHeight;
    },

    cowork(c) {
        c.innerHTML = `<div class="p-10 text-center space-y-12 fade-in h-full flex flex-col justify-center"><span class="text-[10rem] mb-6 drop-shadow-2xl">üèõÔ∏è</span><h2 class="text-6xl font-black tracking-tighter uppercase leading-none text-primary">Creative <br> Studio</h2><p class="text-secondary font-medium px-10 text-sm">Gigabit fiber, premium roasts, and a global collective of builders.</p><button onclick="ui.showToast('Agent Dispatched!')" class="brand-bg py-7 rounded-[2.5rem] font-black text-2xl shadow-2xl w-full uppercase tracking-tighter active:scale-95 transition">Secure Workspace</button></div>`;
    },

    more(c) {
        c.innerHTML = `
            <div class="p-8 space-y-6 fade-in">
                <h2 class="text-4xl font-black uppercase tracking-tighter mb-10 text-primary">HXOUSE Profile</h2>
                <div class="bg-secondary p-12 rounded-[3rem] border border-custom shadow-xl mb-12">
                    <p class="text-[9px] font-black uppercase opacity-40 mb-3 tracking-[0.4em] text-primary">Digital Identity</p>
                    <p class="font-black text-3xl tracking-tighter uppercase mb-2 text-primary">${app.state.customerProfile?.name || 'Guest User'}</p>
                    <p class="text-xs opacity-50 font-black tracking-widest text-primary">+91 ${app.state.customerProfile?.whatsapp_number || '----------'}</p>
                </div>
                <div class="space-y-4">
                    <button onclick="ui.gameModal()" class="w-full p-7 bg-secondary rounded-[1.5rem] text-left font-black border border-custom flex justify-between shadow-xl text-primary"><span>Arcade Center</span><span>üéÆ</span></button>
                    <button onclick="location.reload()" class="w-full p-7 bg-secondary rounded-[1.5rem] text-left font-black border border-custom flex justify-between shadow-xl text-primary"><span>Reset Engine</span><span>‚ü≥</span></button>
                    <button onclick="app.navigateTo('aniga')" class="w-full p-7 brand-bg rounded-[1.5rem] text-left font-black flex justify-between shadow-xl text-primary"><span>Chat with Aniga</span><span>‚ú®</span></button>
                </div>
                <p class="text-center text-[8px] font-black uppercase opacity-20 mt-20 tracking-[1em] text-primary">ANIGA AI CORE v3.1.0</p>
            </div>`;
    },

    payModal() {
        ui.showModal('pay-ui', `
            <h2 class="text-4xl font-black mb-12 uppercase tracking-tighter text-primary">Checkout</h2>
            <div class="space-y-5">
                <button onclick="app.placeOrder('Preview', this)" class="w-full p-8 bg-secondary rounded-3xl text-left font-black border border-custom flex justify-between items-center shadow-xl uppercase text-[10px] tracking-widest text-primary active:brand-bg transition"><span>Simulate Pay</span><span>üñ•Ô∏è</span></button>
                <button onclick="app.placeOrder('Preview', this)" class="w-full p-8 bg-secondary rounded-3xl text-left font-black border border-custom flex justify-between items-center shadow-xl uppercase text-[10px] tracking-widest text-primary active:brand-bg transition"><span>Table Pay</span><span>üíµ</span></button>
            </div>
            <p class="text-center text-[9px] uppercase font-black opacity-40 mt-6 tracking-widest text-primary">System Launching March 1st</p>
            <button onclick="ui.closeModal('pay-ui')" class="w-full mt-6 opacity-30 font-black uppercase text-[10px] tracking-widest text-primary">Return</button>
        `);
    },

    gameModal() {
        ui.showModal('games-ui', `
            <h2 class="text-3xl font-black mb-10 uppercase tracking-tighter text-primary text-center">Arcade</h2>
            <div class="space-y-5">
                <div class="bg-secondary p-10 rounded-[2.5rem] border border-custom flex justify-between items-center shadow-lg text-primary"><p class="font-black uppercase text-xs tracking-widest">Tic-Tac-Toe</p><button onclick="GAMES.ttt.start()" class="brand-bg px-10 py-4 rounded-full font-black text-[10px] uppercase shadow-xl">PLAY</button></div>
                <div class="bg-secondary p-10 rounded-[2.5rem] border border-custom flex justify-between items-center shadow-lg text-primary"><p class="font-black uppercase text-xs tracking-widest">Art Studio</p><button onclick="GAMES.art.start()" class="brand-bg px-10 py-4 rounded-full font-black text-[10px] uppercase shadow-xl">ENTER</button></div>
            </div>
            <button onclick="ui.closeModal('games-ui')" class="w-full mt-10 opacity-30 font-black uppercase text-[10px] tracking-widest text-primary">CLOSE</button>
        `);
    },

    showModal(id, content) {
        const m = document.createElement('div'); m.id = id; m.className = "modal-overlay fixed inset-0 bg-black/98 z-[60] flex items-end p-4 backdrop-blur-xl";
        m.innerHTML = `<div class="modal-content w-full bg-primary p-12 rounded-[4rem] shadow-2xl border border-custom">${content}</div>`;
        $('#modal-container').appendChild(m);
    },

    closeModal(id) { $(`#${id}`)?.remove(); },

    showToast(msg) {
        const t = $('#toast'); $('#toast-message').textContent = msg.toUpperCase();
        t.classList.remove('hidden'); t.classList.add('fade-in');
        setTimeout(() => t.classList.add('hidden'), 2500);
    },

    renderNav() {
        const nav = $('#bottom-nav');
        const items = [{ id: 'home', l: 'Home', i: 'üè†' }, { id: 'order', l: 'Menu', i: '‚òï' }, { id: 'aniga', l: 'Aniga', i: '‚ú®' }, { id: 'cart', l: 'Live', i: 'üõí' }, { id: 'more', l: 'User', i: '‚ò∞' }];
        nav.innerHTML = items.map(item => `
            <button onclick="app.navigateTo('${item.id}')" class="nav-btn flex flex-col items-center flex-1 py-1 transition-all duration-300" id="nav-${item.id}">
                <div class="mb-2 text-2xl">${item.i === '‚ú®' ? '<span class="aniga-float">‚ú®</span>' : item.i}</div>
                <span class="text-[8px] font-black uppercase tracking-[0.2em] opacity-40 text-primary">${item.l}</span>
            </button>
        `).join('');
    },

    updateNav() {
        $$('.nav-btn').forEach(btn => { btn.classList.remove('brand-text', 'scale-110'); btn.querySelector('span').classList.replace('opacity-100', 'opacity-40'); });
        const active = $(`#nav-${app.state.currentPage}`);
        if (active) { active.classList.add('brand-text', 'scale-110'); active.querySelector('span').classList.replace('opacity-40', 'opacity-100'); }
    }
};

const GAMES = {
    ttt: {
        board: Array(9).fill(null), p: 'X', win: null,
        start() {
            this.board.fill(null); this.p = 'X'; this.win = null;
            ui.showModal('ttt-run', `<h2 class="text-4xl font-black mb-12 text-center uppercase tracking-tighter text-primary">Match</h2><div class="grid grid-cols-3 gap-4 w-72 mx-auto mb-12">${this.board.map((_, i) => `<div onclick="GAMES.ttt.play(${i})" class="w-20 h-20 bg-secondary rounded-[1.5rem] flex items-center justify-center text-4xl font-black border-2 border-custom shadow-xl text-primary" id="ttt-${i}"></div>`).join('')}</div><p id="ttt-status" class="text-center font-black uppercase text-[10px] tracking-[0.6em] opacity-40 mb-12 text-primary">TURN: ${this.p}</p><button onclick="ui.closeModal('ttt-run')" class="w-full opacity-30 font-black uppercase text-[10px] tracking-widest text-primary">QUIT</button>`);
        },
        play(i) {
            if (this.board[i] || this.win) return;
            this.board[i] = this.p;
            $(`#ttt-${i}`).textContent = this.p;
            if (this.check()) { this.win = this.p; $('#ttt-status').textContent = `PLAYER ${this.p} WINS!`; $('#ttt-status').classList.add('brand-text'); }
            else if (this.board.every(b => b)) { $('#ttt-status').textContent = `DRAW!`; }
            else { this.p = this.p === 'X' ? 'O' : 'X'; $('#ttt-status').textContent = `TURN: ${this.p}`; }
        },
        check() { const w = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]]; return w.some(l => this.board[l[0]] && this.board[l[0]] === this.board[l[1]] && this.board[l[0]] === this.board[l[2]]); }
    },
    art: {
        painting: false,
        start() {
            ui.showModal('art-run', `<h2 class="text-3xl font-black mb-12 text-center uppercase tracking-tighter text-primary">Studio</h2><canvas id="art-canvas" class="w-full aspect-square rounded-[3.5rem] border-[8px] border-custom shadow-2xl mb-12"></canvas><button onclick="ui.closeModal('art-run')" class="w-full brand-bg py-6 rounded-3xl font-black uppercase text-xs tracking-widest shadow-xl">Export</button>`);
            this.run();
        },
        run() {
            const c = $('#art-canvas'); const ctx = c.getContext('2d');
            c.width = c.clientWidth; c.height = c.clientWidth;
            ctx.strokeStyle = '#fff'; ctx.lineWidth = 12; ctx.lineCap = 'round';
            const draw = (e) => {
                if(!this.painting) return;
                const rect = c.getBoundingClientRect();
                const x = (e.clientX || (e.touches && e.touches[0].clientX)) - rect.left;
                const y = (e.clientY || (e.touches && e.touches[0].clientY)) - rect.top;
                ctx.lineTo(x, y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x, y);
            };
            c.onmousedown = c.ontouchstart = (e) => { this.painting = true; draw(e); };
            c.onmouseup = c.ontouchend = () => { this.painting = false; ctx.beginPath(); };
            c.onmousemove = c.ontouchmove = draw;
        }
    }
};

window.addEventListener('load', () => app.init());
</script>
</body>
</html>
